<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UML – ROSPlann Knowledge base – formal ROS description &mdash; RoboCLuedo #3 1.0.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/assets/jsonview.bundle.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sphinx-needs/libs/html/datatables.min.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sphinx-needs/common.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sphinx-needs/modern.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sphinx-needs/layouts.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sphinx-needs/styles.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/assets/jsonview.bundle.js"></script>
        <script src="../../_static/assets/jsonview_loader.js"></script>
        <script src="../../_static/sphinx-needs/libs/html/datatables.min.js"></script>
        <script src="../../_static/sphinx-needs/libs/html/datatables_loader.js"></script>
        <script src="../../_static/sphinx-needs/libs/html/sphinx_needs_collapse.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="UML – ROSPlan pipeline" href="rosplan-pipeline.html" />
    <link rel="prev" title="UML – robocluedo rosplan – in a nutshell" href="rosplan-arch.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> RoboCLuedo #3
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">README</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../README-sphinx.html">the project main README</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_uml/arch.html">UML overall arch</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Packages Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../robocluedo_armor/index.html">PKG DOCS – robocluedo armor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../robocluedo_armor_msgs/index.html">PKG DOCS – robocluedo_armor_msgs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../robocluedo_vision/index.html">PKG DOCS – robocluedo_vision</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">PKG DOCS – robocluedo_rosplan</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../_docs/new-robocluedo.html">PDDL Design – the new RoboCLuedo PDDL model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_docs/pddl-and-rosplan.html">DOCS – PDDL and ROSPlan</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_docs/run-the-package.html">HOW TO run the package</a></li>
<li class="toctree-l2"><a class="reference internal" href="rosplan-arch.html">UML – robocluedo rosplan – in a nutshell</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">UML – ROSPlann Knowledge base – formal ROS description</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="rosplan-pipeline.html">UML – ROSPlan pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_code_reference/feedback_manager.html">CLASS feedback manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_code_reference/kb_interface.html">NODE kb_interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_code_reference/kb_tools.html">CLASS kb_tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_code_reference/move_to.html">ROSPlan action move_to</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_code_reference/move_to_center.html">ROSPlan action move_to_center</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_code_reference/replan.html">ROSPlan action replan</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_code_reference/rosplan_pipeline_manager.html">NODE rosplan_pipeline_manager.py</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../robocluedo_rosplan_msgs/index.html">PKG DOCS – robocluedo_rosplan_msgs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../robocluedo_movement_controller/index.html">PKG DOCS – robocluedo_movement_controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../robocluedo_movement_controller_msgs/index.html">PKG DOCS – robocluedo_movement_msgs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../robocluedo_mission_manager/index.html">PKG DOCS – robocluedo_mission_manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../robocluedo_module_testing/index.html">PKG DOCS – RoboCLuedo Module Testing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Dependencies Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../robocluedo_dependencies/_docs/erl3-oracle-user-manual.html">Oracle3 – User Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../robocluedo_dependencies/_docs/robocluedo-hunter-user-manual.html">the RoboCLuedo “hunter” URDF model – User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../robocluedo_dependencies/_docs/worlds-user-manual.html">WORLDS – a collection of Gazebo World Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../robocluedo_dependencies/vision_opencv/cv_bridge/doc/index.html">cv_bridge</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Documents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_docs/project-setup.html">RCL3 SETUP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_docs/run-the-project.html">RCL3 RUN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_docs/dev-log-rcl3.html">Development LOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_docs/how-to-setup-doxy-sphinx-ws.html">How to setup Sphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_docs/rest-directives.html">ReStructured Directives – practical documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_docs/sphinx-mock.html">Sphinx for Py – modules mocking</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Extensions and other references</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_ext/plant-uml-reference.html">PlantUML quick reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">RoboCLuedo #3</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">PKG DOCS – robocluedo_rosplan</a> &raquo;</li>
      <li>UML – ROSPlann Knowledge base – formal ROS description</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/robocluedo_rosplan/_uml/rosplan-kb.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="uml-rosplann-knowledge-base-formal-ros-description">
<h1>UML – ROSPlann Knowledge base – formal ROS description<a class="headerlink" href="#uml-rosplann-knowledge-base-formal-ros-description" title="Permalink to this heading"></a></h1>
<hr class="docutils" />
<div class="toctree-wrapper compound">
<p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">UML – ROSPlann Knowledge base – formal ROS description</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#schema-knowledge-base">schema – knowledge base</a></li>
<li class="toctree-l2"><a class="reference internal" href="#schema-class-kb-tools">schema – CLASS kb_tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="#from-here-the-long-list-of-how-tos">(from here) The long list of HOW TOs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-read-a-predicate">HOW TO read a predicate</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#message-rosplan-knowledge-msgs-knowledgequeryservice">message <strong>rosplan_knowledge_msgs/KnowledgeQueryService</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#message-rosplan-knowledge-msgs-knowledgeitem">message <strong>rosplan_knowledge_msgs/KnowledgeItem</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#message-diagnostic-msgs-keyvalue">message <strong>diagnostic_msgs/KeyValue</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-perform-the-reading">how to perform the reading</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-perform-the-reading-using-kb-tools">how to perform the reading using KB tools</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-modify-a-predicate">HOW TO modify a predicate</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#service-rosplan-knowledge-msgs-knowledgeupdateservice">service <strong>rosplan_knowledge_msgs::KnowledgeUpdateService</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-perform-the-update">how to perform the update</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-perform-the-update-with-kb-tools">how to perform the update with kb_tools:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dealing-with-goals">dealing with goals</a></li>
<li class="toctree-l2"><a class="reference internal" href="#schema-node-kb-interface">schema – NODE kb_interface</a></li>
</ul>
</li>
</ul>
</div>
<hr class="docutils" />
<p>This document has been written in order to support the develop of the package, as well as both the coding and the testing phases.</p>
<div class="section" id="schema-knowledge-base">
<h2>schema – knowledge base<a class="headerlink" href="#schema-knowledge-base" title="Permalink to this heading"></a></h2>
<p>here are the main services exposed by the ROSPlan knowledge base. The graph shows the ones used by this project.</p>
<p class="plantuml">
<object data="../../_images/plantuml-c941a61906b76f20e6f34484496e113c56ec98a2.svg" type="image/svg+xml" style="width:1763px;height:355px;background:#FFFFFF;">
<img src="../../_images/plantuml-c941a61906b76f20e6f34484496e113c56ec98a2.png" alt="&#64;startuml

''' INFOS
title robocluedo_armor project structure
skinparam Padding 8
allow_mixing


''' COMPONENTS
database &quot;knowledge base&quot; &lt;&lt;ROSPlan&gt;&gt; as KB


''' SERVICES
/'
() &quot;srv&quot; as SRV_
KB &quot;srv&quot; --&gt; &quot;cl&quot; SRV_
note on link: 
'/

' () &quot;/rosplan_knowledge_base/clear&quot; as SRV_KB_CLEAR
' KB &quot;srv&quot; --&gt; &quot;cl&quot; SRV_KB_CLEAR
' note on link: std_srvs::Empty

() &quot;/rosplan_knowledge_base/state/propositions&quot; as SRV_KB_GET_PRED
KB &quot;srv&quot; --&gt; &quot;cl&quot; SRV_KB_GET_PRED
note on link: rosplan_knowledge_msgs/GetAttributeService

() &quot;/rosplan_knowledge_base/update_array&quot; as SRV_KB_UPDATE
KB &quot;srv&quot; --&gt; &quot;cl&quot; SRV_KB_UPDATE
note on link: rosplan_knowledge_msgs/KnowledgeUpdateService

() &quot;/rosplan_knowledge_base/update&quot; as SRV_KB_UPDATE_ARRAY
KB &quot;srv&quot; --&gt; &quot;cl&quot; SRV_KB_UPDATE_ARRAY
note on link: rosplan_knowledge_msgs/KnowledgeUpdateServiceArray

() &quot;/rosplan_knowledge_base/query_state&quot; as SRV_QUERY
KB &quot;srv&quot; --&gt; &quot;cl&quot; SRV_QUERY
note on link: rosplan_knowledge_msgs/KnowledgeQueryService

&#64;enduml"/>

</object></p>
</div>
<div class="section" id="schema-class-kb-tools">
<h2>schema – CLASS kb_tools<a class="headerlink" href="#schema-class-kb-tools" title="Permalink to this heading"></a></h2>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>the current version has a very poor support for the PDDL fluents, because not required by this kind of project.</p>
</div>
<p>the class <em>kb_tools</em> is used for interacting in a convenient way with the knowledge base. It contains methods for enabling another class (by inheritance) both to read and write to the Knowledge Base. This little schema reports the most important methods provided by the class.</p>
<p class="plantuml">
<object data="../../_images/plantuml-7febc559997f9c93a50f561f7e75253db1aa5711.svg" type="image/svg+xml" style="width:837px;height:630px;background:#FFFFFF;">
<img src="../../_images/plantuml-7febc559997f9c93a50f561f7e75253db1aa5711.png" alt="&#64;startuml

''' INFOS
title robocluedo_armor project structure
skinparam Padding 8
allow_mixing


''' COMPONENTS
package &quot;ROSPlan&quot; {
database &quot;knowledge base&quot; &lt;&lt;ROSPlan&gt;&gt; as KB
}
class &quot;kb_tools&quot; as TOOLS {
+ get_predicate(string pname, map&lt;keyvalue&gt; args) : bool
+ set_predicate(string pname, map&lt;keyvalue&gt; args, bool newvalue) : bool
' + get_goal(string pname, map&lt;keyvalue&gt; args, bool newvalue) : bool
+ set_goal(string pname, map&lt;keyvalue&gt; args, bool newvalue) : bool
}


''' SERVICES
/'
() &quot;srv&quot; as SRV_
KB &quot;srv&quot; --&gt; &quot;cl&quot; SRV_
note on link: 
'/

() &quot;/rosplan_knowledge_base/update&quot; as SRV_KB_UPDATE
KB &quot;srv&quot; --&gt; SRV_KB_UPDATE
note on link: rosplan_knowledge_msgs/KnowledgeUpdateService
SRV_KB_UPDATE --&gt; &quot;cl&quot; TOOLS

() &quot;/rosplan_knowledge_base/query_state&quot; as SRV_QUERY
KB &quot;srv&quot; --&gt; SRV_QUERY
note on link: rosplan_knowledge_msgs/KnowledgeQueryService
SRV_QUERY --&gt; &quot;cl&quot; TOOLS


''' CONNECTIONS
' ...

&#64;enduml"/>

</object></p>
</div>
<hr class="docutils" />
<div class="section" id="from-here-the-long-list-of-how-tos">
<h2>(from here) The long list of HOW TOs<a class="headerlink" href="#from-here-the-long-list-of-how-tos" title="Permalink to this heading"></a></h2>
<p>here’s a short summary about how to deal with the Knowledge Base. Mostly of the snippets introduced here are written in C++ without loss of generality.</p>
</div>
<hr class="docutils" />
<div class="section" id="how-to-read-a-predicate">
<h2>HOW TO read a predicate<a class="headerlink" href="#how-to-read-a-predicate" title="Permalink to this heading"></a></h2>
<p>libraries to import:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;diagnostic_msgs/KeyValue.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;rosplan_knowledge_msgs/KnowledgeItem.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;rosplan_knowledge_msgs/KnowledgeQueryService.h&quot;</span><span class="cp"></span>

<span class="c1">// kb knowledge type</span>
<span class="cp">#define KB_KTYPE_FLUENT 2</span>
<span class="cp">#define KB_KTYPE_PREDICATE 1</span>
</pre></div>
</div>
<p>the client to open:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#define SERVICE_QUERY &quot;/rosplan_knowledge_base/query_state&quot;</span>
<span class="n">ros</span><span class="o">::</span><span class="n">ServiceClient</span><span class="w"> </span><span class="n">cl_query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nh</span><span class="p">.</span><span class="n">serviceClient</span><span class="o">&lt;</span><span class="n">rosplan_knowledge_msgs</span><span class="o">::</span><span class="n">KnowledgeQueryService</span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">SERVICE_QUERY</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>a more detailed way to open the service:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#define SERVICE_QUERY &quot;/rosplan_knowledge_base/query_state&quot;</span>

<span class="c1">// === Predicates Query service === //</span>
<span class="n">TLOG</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Opening client &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">LOGSQUARE</span><span class="p">(</span><span class="w"> </span><span class="n">SERVICE_QUERY</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;...&quot;</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">ros</span><span class="o">::</span><span class="n">ServiceClient</span><span class="w"> </span><span class="n">cl_query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nh</span><span class="p">.</span><span class="n">serviceClient</span><span class="o">&lt;</span><span class="n">rosplan_knowledge_msgs</span><span class="o">::</span><span class="n">KnowledgeQueryService</span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">SERVICE_QUERY</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">cl_query</span><span class="p">.</span><span class="n">waitForExistence</span><span class="p">(</span><span class="w"> </span><span class="n">ros</span><span class="o">::</span><span class="n">Duration</span><span class="p">(</span><span class="w"> </span><span class="n">TIMEOUT_QUERY</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="n">TERR</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;unable to contact the server - timeout expired (&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">TIMEOUT_QUERY</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;s) &quot;</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="c1">// return;</span>
<span class="p">}</span><span class="w"></span>
<span class="n">TLOG</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Opening client &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">LOGSQUARE</span><span class="p">(</span><span class="w"> </span><span class="n">SERVICE_QUERY</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;... OK&quot;</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<div class="section" id="message-rosplan-knowledge-msgs-knowledgequeryservice">
<h3>message <strong>rosplan_knowledge_msgs/KnowledgeQueryService</strong><a class="headerlink" href="#message-rosplan-knowledge-msgs-knowledgequeryservice" title="Permalink to this heading"></a></h3>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>rosplan_knowledge_msgs/KnowledgeItem[] knowledge
---
bool all_true
bool[] results
rosplan_knowledge_msgs/KnowledgeItem[] false_knowledge
</pre></div>
</div>
</div>
<div class="section" id="message-rosplan-knowledge-msgs-knowledgeitem">
<h3>message <strong>rosplan_knowledge_msgs/KnowledgeItem</strong><a class="headerlink" href="#message-rosplan-knowledge-msgs-knowledgeitem" title="Permalink to this heading"></a></h3>
<p>(needed to perform the request)</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># A knowledge item used to represent a piece of the state in ROSPlan

uint8 INSTANCE = 0
uint8 FACT = 1
uint8 FUNCTION = 2
uint8 EXPRESSION = 3
uint8 INEQUALITY = 4

uint8 knowledge_type

# time at which this knowledge becomes true
time initial_time

# knowledge is explicitly false
bool is_negative

#---------
# INSTANCE
#---------

# instance knowledge_type
string instance_type
string instance_name

#----------------------
# PREDICATE OR FUNCTION
#----------------------

# attribute knowledge_type
string attribute_name
diagnostic_msgs/KeyValue[] values

#---------
# FUNCTION
#---------

# function value
float64 function_value

#-----------
# EXPRESSION
#-----------

string optimization
rosplan_knowledge_msgs/ExprComposite expr

#-----------
# INEQUALITY
#-----------

rosplan_knowledge_msgs/DomainInequality ineq
</pre></div>
</div>
</div>
<div class="section" id="message-diagnostic-msgs-keyvalue">
<h3>message <strong>diagnostic_msgs/KeyValue</strong><a class="headerlink" href="#message-diagnostic-msgs-keyvalue" title="Permalink to this heading"></a></h3>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># what to label this value when viewing
string key
# a value to track over time
string value
</pre></div>
</div>
</div>
<div class="section" id="how-to-perform-the-reading">
<h3>how to perform the reading<a class="headerlink" href="#how-to-perform-the-reading" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>reading predicates : if you’re sure that the predicate you’re asking for is unique, use the field response.all_true; or also .response.results[] showing each truth value.</p>
</div></blockquote>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// data for request</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">pname</span><span class="w"></span>
<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">params</span><span class="w"></span>


<span class="c1">// === PREPARE THE REQUEST === //</span>

<span class="n">rosplan_knowledge_msgs</span><span class="o">::</span><span class="n">KnowledgeQueryService</span><span class="w"> </span><span class="n">query</span><span class="p">;</span><span class="w"></span>
<span class="n">rosplan_knowledge_msgs</span><span class="o">::</span><span class="n">KnowledgeItem</span><span class="w"> </span><span class="n">kbm</span><span class="p">;</span><span class="w"></span>

<span class="n">kbm</span><span class="p">.</span><span class="n">knowledge_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KB_KTYPE_PREDICATE</span><span class="p">;</span><span class="w"> </span><span class="c1">// it corresponds to 1</span>
<span class="n">kbm</span><span class="p">.</span><span class="n">attribute_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pname</span><span class="p">;</span><span class="w"> </span><span class="c1">// the name of the predicate</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="o">=</span><span class="n">params</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">it</span><span class="o">!=</span><span class="n">params</span><span class="p">.</span><span class="n">end</span><span class="p">(</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">it</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="n">diagnostic_msgs</span><span class="o">::</span><span class="n">KeyValue</span><span class="w"> </span><span class="n">kv</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="n">kv</span><span class="p">.</span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="n">kv</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="n">kbm</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">kv</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="n">query</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">knowledge</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">kbm</span><span class="w"> </span><span class="p">);</span><span class="w"></span>

<span class="c1">// ... the same thing for each predicate you want</span>
<span class="c1">//    n predicate in list -&gt; n values inside the result</span>

<span class="c1">// === PERFORM THE REQUEST === //</span>

<span class="n">cl_query</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="p">);</span><span class="w"></span>


<span class="c1">// === EVALUATE THE RESULT === //</span>

<span class="kt">bool</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>

<span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">query</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">results</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="c1">// only one predicate compatible</span>
<span class="w">	</span>
<span class="w">	</span><span class="c1">// method 1</span>
<span class="w">	</span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">query</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
<span class="w">	</span><span class="c1">// method 2</span>
<span class="w">	</span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">query</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">all_true</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">else</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="c1">// many predicates (many results...)</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-perform-the-reading-using-kb-tools">
<h3>how to perform the reading using KB tools<a class="headerlink" href="#how-to-perform-the-reading-using-kb-tools" title="Permalink to this heading"></a></h3>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// just one predicate!</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">pname</span><span class="w"></span>
<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">params</span><span class="w"></span>

<span class="n">kb_tools</span><span class="w"> </span><span class="n">kbt</span><span class="p">;</span><span class="w"></span>

<span class="kt">bool</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbt</span><span class="p">.</span><span class="n">get_predicate</span><span class="p">(</span><span class="w"> </span><span class="n">pname</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">kbt</span><span class="o">-&gt;</span><span class="n">ok</span><span class="p">())</span><span class="w"></span>
<span class="w">	</span><span class="n">ROS_ERR</span><span class="p">(</span><span class="s">&quot;kb tools get predicate&quot;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="how-to-modify-a-predicate">
<h2>HOW TO modify a predicate<a class="headerlink" href="#how-to-modify-a-predicate" title="Permalink to this heading"></a></h2>
<p>libraries:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;diagnostic_msgs/KeyValue.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;rosplan_knowledge_msgs/KnowledgeItem.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;rosplan_knowledge_msgs/KnowledgeUpdateService.h&quot;</span><span class="cp"></span>

<span class="c1">// kb knowledge type</span>
<span class="cp">#define KB_KTYPE_FLUENT 2</span>
<span class="cp">#define KB_KTYPE_PREDICATE 1</span>

<span class="c1">// kb action</span>
<span class="cp">#define KB_ADD_KNOWLEDGE 0</span>
<span class="cp">#define KB_DEL_KNOWLEDGE 2</span>
</pre></div>
</div>
<p>the service to interact with:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#define SERVICE_KB_UPDATE &quot;/rosplan_knowledge_base/update&quot;</span>
<span class="n">ros</span><span class="o">::</span><span class="n">ServiceClient</span><span class="w"> </span><span class="n">cl_kb_update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nh</span><span class="p">.</span><span class="n">serviceClient</span><span class="o">&lt;</span><span class="n">rosplan_knowledge_msgs</span><span class="o">::</span><span class="n">KnowledgeUpdateService</span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">SERVICE_KB_UPDATE</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>a more detailed way to open the service:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#define SERVICE_KB_UPDATE &quot;/rosplan_knowledge_base/update&quot;</span>

<span class="c1">// === update service === //</span>
<span class="n">TLOG</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Opening client &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">LOGSQUARE</span><span class="p">(</span><span class="w"> </span><span class="n">SERVICE_KB_UPDATE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;...&quot;</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">ros</span><span class="o">::</span><span class="n">ServiceClient</span><span class="w"> </span><span class="n">cl_kb_update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nh</span><span class="p">.</span><span class="n">serviceClient</span><span class="o">&lt;</span><span class="n">rosplan_knowledge_msgs</span><span class="o">::</span><span class="n">KnowledgeUpdateService</span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">SERVICE_KB_UPDATE</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">cl_kb_update</span><span class="p">.</span><span class="n">waitForExistence</span><span class="p">(</span><span class="w"> </span><span class="n">ros</span><span class="o">::</span><span class="n">Duration</span><span class="p">(</span><span class="w"> </span><span class="n">TIMEOUT_KB_UPDATE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="n">TERR</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;unable to contact the server - timeout expired (&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">TIMEOUT_KB_UPDATE</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;s) &quot;</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">TLOG</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Opening client &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">LOGSQUARE</span><span class="p">(</span><span class="w"> </span><span class="n">SERVICE_KB_UPDATE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;... OK&quot;</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<div class="section" id="service-rosplan-knowledge-msgs-knowledgeupdateservice">
<h3>service <strong>rosplan_knowledge_msgs::KnowledgeUpdateService</strong><a class="headerlink" href="#service-rosplan-knowledge-msgs-knowledgeupdateservice" title="Permalink to this heading"></a></h3>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>uint8 update_type
rosplan_knowledge_msgs/KnowledgeItem knowledge
---
bool success
</pre></div>
</div>
<p>message <strong>rosplan_knowledge_msgs/KnowledgeItem</strong> (see above)</p>
<p>message <strong>diagnostic_msgs/KeyValue</strong> (see above)</p>
</div>
<div class="section" id="how-to-perform-the-update">
<h3>how to perform the update<a class="headerlink" href="#how-to-perform-the-update" title="Permalink to this heading"></a></h3>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">pname</span><span class="w"></span>
<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">params</span><span class="w"></span>
<span class="kt">bool</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// the new val for the predicate</span>


<span class="c1">// === PREPARE THE REQUEST === //</span>

<span class="n">rosplan_knowledge_msgs</span><span class="o">::</span><span class="n">KnowledgeUpdateService</span><span class="w"> </span><span class="n">kbm</span><span class="p">;</span><span class="w"></span>

<span class="n">kbm</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">update_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nl">KB_ADD_KNOWLEDGE</span> <span class="p">:</span><span class="w"> </span><span class="n">KB_DEL_KNOWLEDGE</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">kbm</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">knowledge</span><span class="p">.</span><span class="n">knowledge_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KB_KTYPE_PREDICATE</span><span class="p">;</span><span class="w"></span>
<span class="n">kbm</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">knowledge</span><span class="p">.</span><span class="n">attribute_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pname</span><span class="p">;</span><span class="w"></span>

<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="o">=</span><span class="n">params</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">it</span><span class="o">!=</span><span class="n">params</span><span class="p">.</span><span class="n">end</span><span class="p">(</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">it</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="n">diagnostic_msgs</span><span class="o">::</span><span class="n">KeyValue</span><span class="w"> </span><span class="n">kv</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="n">kv</span><span class="p">.</span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="n">kv</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="n">kbm</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">knowledge</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">kv</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="c1">// === PERFORM THE REQUEST === //</span>

<span class="n">cl_kb_update</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="w"> </span><span class="n">kbm</span><span class="w"> </span><span class="p">);</span><span class="w"></span>


<span class="c1">// === EVALUATE THE RESULT === //</span>

<span class="kt">bool</span><span class="w"> </span><span class="n">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbm</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">success</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-perform-the-update-with-kb-tools">
<h3>how to perform the update with kb_tools:<a class="headerlink" href="#how-to-perform-the-update-with-kb-tools" title="Permalink to this heading"></a></h3>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">pname</span><span class="w"></span>
<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">params</span><span class="w"></span>
<span class="kt">bool</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// the new val for the predicate</span>

<span class="n">kb_tools</span><span class="w"> </span><span class="n">kbt</span><span class="p">;</span><span class="w"></span>

<span class="kt">bool</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbt</span><span class="p">.</span><span class="n">set_predicate</span><span class="p">(</span><span class="w"> </span><span class="n">pname</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">kbt</span><span class="o">-&gt;</span><span class="n">ok</span><span class="p">())</span><span class="w"></span>
<span class="w">	</span><span class="n">ROS_ERR</span><span class="p">(</span><span class="s">&quot;kb tools set predicate&quot;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="dealing-with-goals">
<h2>dealing with goals<a class="headerlink" href="#dealing-with-goals" title="Permalink to this heading"></a></h2>
<p>libraries:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;diagnostic_msgs/KeyValue.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;rosplan_knowledge_msgs/KnowledgeItem.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;rosplan_knowledge_msgs/KnowledgeUpdateService.h&quot;</span><span class="cp"></span>

<span class="c1">// kb knowledge type</span>
<span class="cp">#define KB_KTYPE_FLUENT 2</span>
<span class="cp">#define KB_KTYPE_PREDICATE 1</span>

<span class="c1">// kb action</span>
<span class="cp">#define KB_ADD_KNOWLEDGE 0</span>
<span class="cp">#define KB_DEL_KNOWLEDGE 2</span>
<span class="cp">#define KB_ADD_GOAL 1</span>
<span class="cp">#define KB_DEL_GOAL 3</span>
</pre></div>
</div>
<p>message <strong>rosplan_knowledge_msgs/KnowledgeUpdate</strong> (see above)</p>
<p>in order to make this update, open a client with <code class="docutils literal notranslate"><span class="pre">/rosplan_knowledge_base/update</span></code> of type <code class="docutils literal notranslate"><span class="pre">rosplan_knowledge_msgs::KnowledgeUpdate</span></code></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#define SERVICE_KB_UPDATE &quot;/rosplan_knowledge_base/update&quot;</span>
<span class="n">ros</span><span class="o">::</span><span class="n">ServiceClient</span><span class="w"> </span><span class="n">cl_kb_update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nh</span><span class="p">.</span><span class="n">serviceClient</span><span class="o">&lt;</span><span class="n">rosplan_knowledge_msgs</span><span class="o">::</span><span class="n">KnowledgeUpdateService</span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">SERVICE_KB_UPDATE</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>here’s the code for the action:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">pname</span><span class="w"></span>
<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">params</span><span class="w"></span>
<span class="kt">bool</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// the new val for the predicate</span>


<span class="c1">// === PREPARE THE REQUEST === //</span>

<span class="n">rosplan_knowledge_msgs</span><span class="o">::</span><span class="n">KnowledgeUpdateService</span><span class="w"> </span><span class="n">kbm</span><span class="p">;</span><span class="w"></span>

<span class="n">kbm</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">update_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nl">KB_ADD_GOAL</span> <span class="p">:</span><span class="w"> </span><span class="n">KB_DEL_GOAL</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">kbm</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">knowledge</span><span class="p">.</span><span class="n">knowledge_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KB_KTYPE_PREDICATE</span><span class="p">;</span><span class="w"></span>
<span class="n">kbm</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">knowledge</span><span class="p">.</span><span class="n">attribute_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pname</span><span class="p">;</span><span class="w"></span>

<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="o">=</span><span class="n">params</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">it</span><span class="o">!=</span><span class="n">params</span><span class="p">.</span><span class="n">end</span><span class="p">(</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">it</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="n">diagnostic_msgs</span><span class="o">::</span><span class="n">KeyValue</span><span class="w"> </span><span class="n">kv</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="n">kv</span><span class="p">.</span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="n">kv</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="n">kbm</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">knowledge</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">kv</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="c1">// === PERFORM THE REQUEST === //</span>

<span class="n">cl_kb_update</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="w"> </span><span class="n">kbm</span><span class="w"> </span><span class="p">);</span><span class="w"></span>


<span class="c1">// === EVALUATE THE RESULT === //</span>

<span class="kt">bool</span><span class="w"> </span><span class="n">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbm</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">success</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="schema-node-kb-interface">
<h2>schema – NODE kb_interface<a class="headerlink" href="#schema-node-kb-interface" title="Permalink to this heading"></a></h2>
<p>this ROS node provides functionalities for replanning and for altering/reading the knowledge base in a convenient, general way, not constraining the other nodes to take into account the peculiarities of the current PDDL. This makes the system more flexible and adaptable to other types of PDDL problems.</p>
<p>The node takes advantage of the class <em>kb_tools</em> which is applied to handle the data inside the kb.</p>
<p class="plantuml">
<object data="../../_images/plantuml-381abf4779fccebea84599c366c0e95f72fcc8e4.svg" type="image/svg+xml" style="width:1182px;height:623px;background:#FFFFFF;">
<img src="../../_images/plantuml-381abf4779fccebea84599c366c0e95f72fcc8e4.png" alt="&#64;startuml

''' INFOS
title robocluedo_rosplan KB_INTERFACE node
skinparam Padding 8
allow_mixing


''' COMPONENTS
component &quot;KB interface&quot; &lt;&lt;node&gt;&gt; as KB_INTERFACE

class &quot;kb_tools&quot; as TOOLS {
+ get_predicate(string pname, map&lt;keyvalue&gt; args) : bool
+ set_predicate(string pname, map&lt;keyvalue&gt; args, bool newvalue) : bool
' + get_goal(string pname, map&lt;keyvalue&gt; args, bool newvalue) : bool
+ set_goal(string pname, map&lt;keyvalue&gt; args, bool newvalue) : bool
}
KB_INTERFACE &lt;|-- TOOLS

() &quot;/replan&quot; as SRV_REPLAN
KB_INTERFACE &quot;srv&quot; --&gt; SRV_REPLAN
note on link: std_msgs::Empty

() &quot;/update_goal&quot; as SRV_UPDATE_GOAL
KB_INTERFACE &quot;srv&quot; --&gt; SRV_UPDATE_GOAL
note on link: robocluedo_rosplan_msgs::UpdateGoal


''' SERVICES
/'
() &quot;srv&quot; as SRV_
KB_INTERFACE &quot;srv&quot; &lt;-- &quot;cl&quot; SRV_
note on link: 
'/

' () &quot;/rosplan_knowledge_base/clear&quot; as SRV_KB_CLEAR
' KB &quot;srv&quot; --&gt; &quot;cl&quot; SRV_KB_CLEAR
' note on link: std_srvs::Empty

() &quot;/rosplan_knowledge_base/update_array&quot; as SRV_KB_UPDATE
TOOLS &quot;cl&quot; &lt;-- SRV_KB_UPDATE
note on link: rosplan_knowledge_msgs/KnowledgeUpdateService

() &quot;/rosplan_knowledge_base/query_state&quot; as SRV_QUERY
TOOLS &quot;cl&quot; &lt;-- SRV_QUERY
note on link: rosplan_knowledge_msgs/KnowledgeQueryService


''' CONNECTIONS
' ...

&#64;enduml"/>

</object></p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="rosplan-arch.html" class="btn btn-neutral float-left" title="UML – robocluedo rosplan – in a nutshell" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="rosplan-pipeline.html" class="btn btn-neutral float-right" title="UML – ROSPlan pipeline" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Francesco Ganci.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>